{% extends 'adminPanel/base.html' %}

{% load static %}

{% block title %}<title>Murojaatlar</title>{% endblock title %}

{% block style %}
    <style>
        .position-icons {
            color: inherit;
        }
        .position-icons:hover {
            color: green;
        }
        .position-icons:nth-child(2) {
            margin-left: 20px;
        }
        .position-icons:nth-child(2):hover {
            color: red;
        }
          .navbar-sidebar .navbar__list .noti__item i {
            font-size: 20px;
            color: inherit;
          }
          .navbar-sidebar .navbar__list .noti__item .quantity {
            left: 11px;
            top: 11px;
            right: unset;
          }
          .modal::before {
            content: none;
          }
          body {
            overflow: hidden;
          }
          .appeal__filter {
            position: fixed;
            left: 320px;
            top: 120px;
            background-color: #fff;
          
            width: 250px;
            padding: 20px;
          }
          .appeal__filter_in_date {
            left: unset;
            right: 20px;
          }
          .appeal__filter ul {
            list-style-type: none;
            margin: 0;
            padding: 0;
          }
          .appeal__filter h4 {
            margin-bottom: 10px;
          }
          .appeal__filter label:hover {
            color: #4272d7;
            cursor: pointer;
          }
          .appeal__filter select:hover,
          .appeal__filter input[type="radio"]:hover {
            cursor: pointer;
          }
          .modal-answer-textarea {
            padding: 10px;
          }
          #accepted {
            display: none;
          }
          #accepted + label {
            margin-left: 30px;
          }
          #rejected {
            display: none;
          }
          #rejected + label {
            margin-left: 30px;
          }
          #accepted:checked + label {
            color: green;
          }
          #rejected:checked + label {
            color: red;
          }
          
          .modal-answer-textarea {
            height: 300px !important;
            max-height: 300px;
          }
          
        #in_site {
            display: none;
        }
        #in_email {
            display: none;
        }
        #in_site_and_email {
            display: none;
        }
        
        #in_site:checked + label {
            color: green;
        }
        #in_email:checked + label {
            color: green;
        }
        #in_site_and_email:checked + label {
            color: green;
        }
        
        #in_site + label {
            margin-left: 35px;
        }
        
        #in_email + label {
            margin-left: 35px;
        }
        #in_site_and_email + label {
            margin-left: 35px;
        }
        
        #send_answer {
            display: none;
        }
        #save_answer {
            display: none;
        }
        
        #send_answer:checked + label {
            color: green;
        }
        #save_answer:checked + label {
            color: #bbbb05;
        }
        
        #send_answer + label {
            margin-left: 35px;
        }
        #save_answer + label {
            margin-left: 35px;
        }
        
        label:hover {
            cursor: pointer;
        }
        .table-earning tbody td {
            white-space: unset;
            vertical-align: middle;
        }
        .table-responsive.table--no-card {
            max-height: 650px;
        }

        tr th:first-child,
        tr td:first-child {
            padding: 22px;
        }
        thead {
            position: sticky;
            top: 0;
        }
        .filter_icon {
            position: absolute;
            left: 100%;
            top: 0;
            
            cursor: pointer;
            font-size: 30px;
            background-color: #4272d7;
            padding: 5px 25px;
            color: #fff;

            transition: .1s linear
        }
        .filter_icon i {
            display: block;
        }
        .filter_icon:hover {
            background-color: #4272d7c9;
            color: #00000073;
        }
        .appeal__filter_in_date .filter_icon {
            left: unset;
            right: 100%;
        }

    </style>
{% endblock style %}

{% block header_mobile_nav %}
    <nav class="navbar-mobile">
        <div class="container-fluid">
            <ul class="navbar-mobile__list list-unstyled">
                <li>
                    <a class="" href="{% url 'dashboard' request.user.username %}">
                        <i class="fas fa-chart-bar"></i>Statistika</a>
                </li>
                <li class="noti__item">
                    <a href="#">
                        <i class="fas fa-envelope"></i>
                        <span class="quantity">1</span>
                        Murojaatlar
                    </a>
                </li>
                <li>
                    <a href="{% url 'answers' %}">
                        <i class="fas fa-reply"></i>
                        Javoblar
                    </a>
                </li>
                <li>
                    <a href="form.html">
                        <i class="far fa-comments"></i>Chat</a>
                </li>
            </ul>
        </div>
    </nav>
{% endblock header_mobile_nav %}

{% block aside_nav %}
    <nav class="navbar-sidebar">
        <ul class="list-unstyled navbar__list">
            <li>
                <a class="js-arrow" href="{% url 'dashboard' request.user.username %}">
                    <i class="fas fa-chart-bar"></i>Statistika</a>
            </li>
            <li class="noti__item active has-sub">
                <a href="{% url 'appeals' %}">
                    <i class="fas fa-envelope"></i>
                    <span class="quantity">{{ appeals_cnt }}</span>
                    Murojaatlar
                </a>
            </li>
            <li>
                <a href="{% url 'answers' %}">
                    <i class="fas fa-reply"></i>Javoblar</a>
            </li>
            <li>
                <a href="form.html">
                    <i class="fas fa-comments"></i>Chat</a>
            </li>
            <li>
                <a href="{% url 'applicants-view' %}">
                    <i class="fas fa-book"></i>Murojaatchilar paneli</a>
            </li>
        </ul>
    </nav>
{% endblock aside_nav %}


{% block search %}
    <form class="form-header" action="{% url 'appeals' %}">
        <input class="au-input au-input--xl" type="text" name="search" value="{{ search_appeal }}" placeholder="Murojaatni qidirish..." />
        <button class="au-btn--submit" type="submit">
            <i class="zmdi zmdi-search"></i>
        </button>
    </form>
    <form class="form-header" action="{% url 'appeals' %}" method="get">
        <input class="au-input" type="date" name="search_in_date" min="2022-04-20" value="{{ search_date }}"/>
        <button class="au-btn--submit" type="submit">
            <i class="zmdi zmdi-search"></i>
        </button>
    </form>
{% endblock search %}
{% block content %}
<div class="main-content">
    <div class="section__content section__content--p30">
            <div class="container-fluid">
                {% if appeals %}
                    <form method="get">

                        <div class="appeal__filter">
                            <h4>Viloyat</h4>
                            <select id="country" onInput='myFunction()' class="w-100 p-1" name="province">
                                <option value="">umumiy</option>
                                <option value="toshkent">Toshkent</option>
                                <option value="samarqand">Samarqand</option>
                                <option value="andijon">Andijon</option>
                                <option value="fargona">Fargona</option>
                                <option value="namangan">Namangan</option>
                                <option value="qashqadaryo">Qashqadaryo</option>
                                <option value="surxondaryo">Surxondaryo</option>
                                <option value="buxoro">Buxoro</option>
                                <option value="navoiy">Navoiy</option>
                                <option value="xorazm">Xorazm</option>
                                <option value="sirdaryo">Sirdaryo</option>
                                <option value="jizzax">Jizzax</option>
                                <option value="qoraqalpoq">Qoraqalpog'iston Respublikasi</option>
                            </select>
                            <hr>
                            <h4>Murojaat yo'nalishi</h4>
                            <select class="w-100 p-1" name="appeal_direction">
                                <option value="">umumiy</option>
                                <option value="diplom_olish">Diplom olish masalalari</option>
                                <option value="ishga_joylash">Ishga joylash, ishdagi tortishuv, oylik maoshi</option>
                                <option value="kontrakt_tolovi">Kontrakt to'lovi to'g'risida</option>
                                <option value="mag_masalalari">Magistratura masalalari</option>
                                <option value="fuqarolar_murojaatlari">Fuqarolar murojaatlari to'g'risida</option>
                                <option value="moliyaviy_masalalar">Moliyaviy masalalar</option>
                                <option value="talaba_ustidan">Talaba ustidan shikoyat</option>
                                <option value="rahbar_faoliyatidan">Rahbar faoliyatidan norozilik arizasi</option>
                                <option value="stipendiya_masalalari">Stipendiya masalalari</option>
                                <option value="oqishga_kirish">O'qishga kirish to'g'risida</option>
                                <option value="oqishni_kochirish">O'qishni ko'chirish to'g'risida</option>
                                <option value="oqishni_tiklash">O'qishni tiklash to'g'risida</option>
                                <option value="ijodiy_imtihondan">Ijodiy imtihondan norozilik to'g'risida</option>
                                <option value="diplom_xaqqoniyligini">Diplom xaqqoniyligini tasdiqlab berish to'g'risida</option>
                                <option value="nafaqa_masalalari">Nafaqa masalalari</option>
                                <option value="arxiv_malumotlarini">Arxiv ma'lumotlarini olish to'grisida</option>
                                <option value="ikkinchi_mutaxasislik">Ikkinchi mutaxasislik</option>
                                <option value="kitob_nashr">Kitob nashr qilish</option>
                                <option value="ixtiro_qilish">Ixtiro qilish taklifi</option>
                                <option value="taklif_va">Taklif va minnatdorchilik</option>
                                <option value="sirtqi_oqish">Sirtqi o'qish masalalari</option>
                                <option value="yotoqxona_masalalari">Yotoqxona masalalari bo'yicha</option>
                                <option value="olimpiada_masalasi">Olimpiada masalasi bo'yicha</option>
                                <option value="boshqa_yo">Boshqa savollar</option>
                            </select>
                            <hr>

                            <h4>Murojaat turi</h4>
                            <ul>
                                <li>
                                    <label>
                                        <input type="radio" checked name="appeal_type" value="">
                                        Umumiy
                                    </label>
                                </li>
                                <li>
                                    <label>
                                        <input type="radio" name="appeal_type" value="ariza">
                                        Ariza
                                    </label>
                                </li>
                                <li>
                                    <label>
                                        <input type="radio" name="appeal_type" value="shikoyat">
                                        Shikoyat
                                    </label>
                                </li>
                                <li>
                                    <label>
                                        <input type="radio" name="appeal_type" value="taklif">
                                        Taklif
                                    </label>
                                </li>
                            </ul>
                            <hr>

                            <h4>Murojaatchi turi</h4>
                            <ul>
                                <li>
                                    <label>
                                        <input type="radio" checked name="applicant_type" value="">
                                        umumiy
                                    </label>
                                </li>
                                <li>
                                    <label>
                                        <input type="radio" name="applicant_type" value="yuridik_shaxs">
                                        Yuridik shaxs
                                    </label>
                                </li>
                                <li>
                                    <label>
                                        <input type="radio" name="applicant_type" value="jismoniy_shaxs">
                                        Jismoniy shaxs
                                    </label>
                                </li>
                            </ul>
                            <hr>

                            <h4>Murojaat javobi</h4>
                            <ul>
                                <li>
                                    <label>
                                        <input type="radio" checked name="yes_or_no_answer" value="">
                                        Umumiy
                                    </label>
                                </li>
                                <li>
                                    <label>
                                        <input type="radio" name="yes_or_no_answer" value="yes">
                                        Bor 
                                    </label>
                                </li>
                                <li>
                                    <label>
                                        <input type="radio" name="yes_or_no_answer" value="no">
                                        yo'q
                                    </label>
                                </li>
                            </ul>

                            <button><span class="filter_icon"><i class="fas fa-sliders-h"></i></span></button>

                        </div>

                        <div class="appeal__filter appeal__filter_in_date">
                            <h4>Murojaat holati</h4>
                            <ul>
                                <li>
                                    <label>
                                        <input type="radio" checked name="appeal_status" value="">
                                        Umumiy
                                    </label>
                                </li>
                                <li>
                                    <label>
                                        <input type="radio" name="appeal_status" value="new">
                                        yangi
                                    </label>
                                </li>
                                <li>
                                    <label>
                                        <input type="radio" name="appeal_status" value="process">
                                        Ko'rib chiqilmoqda
                                    </label>
                                </li>
                                <li>
                                    <label>
                                        <input type="radio" name="appeal_status" value="completed">
                                        Bajarilgan
                                    </label>
                                </li>
                                <li>
                                    <label>
                                        <input type="radio" name="appeal_status" value="rejected">
                                        Rad etilgan
                                    </label>
                                </li>
                            </ul>
                            <hr>

                            <h4>Kim tomonidan</h4>
                            <ul>
                                <li>
                                    <label>
                                        <input type="radio" checked name="applicant_position" value="">
                                        Umumiy
                                    </label>
                                </li>
                                <li>
                                    <label>
                                        <input type="radio" name="applicant_position" value="talaba">
                                        Talaba
                                    </label>
                                </li>
                                <li>
                                    <label>
                                        <input type="radio" name="applicant_position" value="ota_ona">
                                        Ota ona
                                    </label>
                                </li>
                                <li>
                                    <label>
                                        <input type="radio" name="applicant_position" value="oqituvchi">
                                        O'qituvchi
                                    </label>
                                </li>
                                <li>
                                    <label>
                                        <input type="radio" name="applicant_position" value="universitet_xodimi">
                                        universitet_xodimi
                                    </label>
                                </li>
                                <li>
                                    <label>
                                        <input type="radio" name="applicant_position" value="tashkilot">
                                        tashkilot
                                    </label>
                                </li>
                            </ul>
                            <hr>

                            <h4>Sana</h4>
                            <ul>
                                <li>
                                    <label>
                                        <input type="radio" checked name="date" value="">
                                        Umumiy
                                    </label>
                                </li>
                                <li>
                                    <label>
                                        <input type="radio" name="date" value="day">
                                        bugun
                                    </label>
                                </li>
                                <li>
                                    <label>
                                        <input type="radio" name="date" value="week">
                                        oxirgi xafta
                                    </label>
                                </li>
                                <li>
                                    <label>
                                        <input type="radio" name="date" value="month"> 
                                        oxirgi oy
                                    </label>
                                </li>
                                <li>
                                    <label>
                                        <input type="radio" name="date" value="year">
                                        Oxirgi yil
                                    </label>
                                </li>
                            </ul>
                            <button><span class="filter_icon"><i class="fas fa-sliders-h"></i></span></button>
                        </div>

                    </form>
                    <div class="row">
                        <div class="col-md-8 mx-auto">
                            {% if messages %}
                                {% for msg in messages %}
                                    {% if msg.tags == 'error' %}
                                        <div class="sufee-alert alert with-close alert-danger alert-dismissible fade show">
                                    {% else %}
                                        <div class="sufee-alert alert with-close alert-primary alert-dismissible fade show">
                                    {% endif %}
                                                {{ msg }}
                                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                {% endfor %}
                            {% endif %}
                            {% comment %} <h2 class="title-1 m-l-100 text-left" >Murojaatlar</h2> {% endcomment %}
                            <h2 class="title-1 m-b-25 text-center" >Murojaatlar</h2>
                            
                            <div class="table-responsive table--no-card m-b-40">
                                <table class="table table-fixed table-borderless table-striped table-earning">
                                    <thead>
                                        <tr>
                                            <th>No</th>
                                            <th style="text-align: center">F I O</th>
                                            <th>Muojaat turi</th>
                                            <th>Kim tomonidan</th>
                                            <th>file</th>
                                        </tr>
                                    </thead>
                                    <tbody id="appealsList">
                                        <!-- {% for appeal in appeals %}
                                            <tr>
                                                <th>{{ forloop.counter }}</th>
                                                <td data-toggle="modal" data-target="#scrollmodal{{ appeal.pk }}" style="word-break: break-all;">{{ appeal.applicant_name }}</td>
                                                <td>{{ appeal.appeal_type }}</td>
                                                <td>{{ appeal.applicant_position }}</td>
                                                {% if appeal.appeal_file %}
                                                    <td>
                                                        <a href="{% url 'download-appealFile' appeal.id %}" style="color: #4272d7">{{ appeal.filename }}</a>
                                                    </td>
                                                {% else %}
                                                    <td>-</td>
                                                {% endif %}
                                            </tr>
                                        {% endfor %} -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                {% else %}
                    <h2 class="title-1 m-b-25">Xozircha Murojaatlar yo'q</h2>
                {% endif %}
            </div>
        </div>
</div>
{% endblock content %}
{% block modal %}
    {% for appeal in appeals %}
        <div class="modal fade" id="scrollmodal{{ appeal.pk }}" tabindex="-1" role="dialog" aria-labelledby="scrollmodalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="scrollmodalLabel">{{ appeal.applicant_name }} murojaati</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <ul>
                            <li style="padding: 5px 0; border-bottom: 1px solid #ccc; margin-bottom: 10px">
                                <h5 style="margin-bottom: 5px">F I O:</h5>
                                <p style="text-decoration: underline; margin-left: 20px">{{ appeal.applicant_name }}</p>
                            </li>
                            <li style="padding: 5px 0; border-bottom: 1px solid #ccc; margin-bottom: 10px">
                                <h5 style="margin-bottom: 5px">Tel raqami:</h5>
                                <p style="text-decoration: underline; margin-left: 20px">{{ appeal.applicant_tel_num }}</p>
                            </li>
                            <li style="padding: 5px 0; border-bottom: 1px solid #ccc; margin-bottom: 10px">
                                <h5 style="margin-bottom: 5px">Email:</h5>
                                {% if appeal.applicant_email %}
                                    <p style="text-decoration: underline; margin-left: 20px">{{ appeal.applicant_email }}</p>
                                {% else %}
                                    <p style="text-decoration: underline; margin-left: 20px">Ko'rsatilmagan</p>
                                {% endif %}
                            </li>
                            <li style="padding: 5px 0; border-bottom: 1px solid #ccc; margin-bottom: 10px">
                                <h5 style="margin-bottom: 5px">Yuborilgan sana:</h5>
                                <p style="text-decoration: underline; margin-left: 20px">{{ appeal.created_date }}</p>
                            </li>
                            <li style="padding: 5px 0; border-bottom: 1px solid #ccc; margin-bottom: 10px">
                                <h5 style="margin-bottom: 5px">Viloyat:</h5>
                                <p style="text-decoration: underline; margin-left: 20px">{{ appeal.applicant_province }}</p>
                            </li>
                            <li style="padding: 5px 0; border-bottom: 1px solid #ccc; margin-bottom: 10px">
                                <h5 style="margin-bottom: 5px">Murojaat yo'nalishi:</h5>
                                <p style="text-decoration: underline; margin-left: 20px">{{ appeal.appeal_direction }}</p>
                            </li>
                            <li style="padding: 5px 0; border-bottom: 1px solid #ccc; margin-bottom: 10px">
                                <h5 style="margin-bottom: 5px">Murojaat turi:</h5>
                                <p style="text-decoration: underline; margin-left: 20px">{{ appeal.appeal_type }}</p>
                            </li>
                            <li style="padding: 5px 0; border-bottom: 1px solid #ccc; margin-bottom: 10px">
                                <h5 style="margin-bottom: 5px">murojaatchi turi:</h5>
                                <p style="text-decoration: underline; margin-left: 20px">{{ appeal.applicant_type }}</p>
                            </li>
                            <li style="padding: 5px 0; border-bottom: 1px solid #ccc; margin-bottom: 10px">
                                <h5 style="margin-bottom: 5px">Kim tomonidan:</h5>
                                <p style="text-decoration: underline; margin-left: 20px">{{ appeal.applicant_position }}</p>
                            </li>
                            <li style="padding: 5px 0; border-bottom: 1px solid #ccc; margin-bottom: 10px">
                                <h5 style="margin-bottom: 5px">Murojaat mavzusi:</h5>
                                <p style="text-decoration: underline; margin-left: 20px">{{ appeal.appeal_subject }}</p>
                            </li>
                            <li style="padding: 5px 0; border-bottom: 1px solid #ccc; margin-bottom: 10px">
                                <h5 style="margin-bottom: 5px">Murojaat fayl ko'rinishi:</h5>
                                <p style="text-decoration: underline; margin-left: 20px">{{ appeal.filename }}</p>
                            </li>
                            <li style="padding: 5px 0;">
                                <h5 style="margin-bottom: 20px">Murojaat mazmuni:</h5>
                                <p style="border: 1px solid #ccc; padding: 10px; height: 300px; overflow-y: scroll; word-break: break-all;">
                                    {{ appeal.appeal_text }}
                                </p>
                            </li>
                            <li style="padding: 5px 0;">
                                <hr style="height: 15px; background-color: #ccc; border-radius: 300%;">
                                <h4 style="margin-bottom: 20px">Javob yozish:</h4>
                                <textarea class="modal-answer-textarea" style="border: 1px solid #ccc; width: 100%;"></textarea>
                                <input type="file">
                            </li>
                            <li style="padding: 5px 0;">
                                <hr>
                                <h4 style="margin-bottom: 20px">Javob turi:</h4>
                                <input type="radio" name="type__answer" id="accepted" checked>
                                <label for="accepted">
                                    <i class="fas fa-check"></i>
                                    Bajarildi
                                </label>
                                <input type="radio" name="type__answer" id="rejected">
                                <label for="rejected">
                                    <i class="fas fa-close"></i>
                                    Rad etildi
                                </label>
                            </li>
                            <li style="padding: 5px 0;">
                                <hr>
                                <h4 style="margin-bottom: 20px">Javob manzili:</h4>
                                <input type="radio" name="address__answer" id="in_site" checked>
                                <label for="in_site">
                                    <i class='fab fa-chrome'></i>
                                    Sayt
                                </label>
                                <input type="radio" name="address__answer" id="in_email">
                                <label for="in_email">
                                    <i class="fas fa-envelope"></i>
                                    Email
                                </label>
                                <input type="radio" name="address__answer" id="in_site_and_email">
                                <label for="in_site_and_email">
                                    <i class='fab fa-chrome'></i> Sayt va<span style="margin-left: 10px;"><i class="fas fa-envelope"></i> Email</span>
                                </label>
                            </li>
                            <li style="padding: 5px 0;">
                                <hr>
                                <h4 style="margin-bottom: 20px">Javob holati:</h4>
                                <input type="radio" name="active__answer" id="send_answer" checked>
                                <label for="send_answer">
                                    <i class='fa fa-send'></i>
                                    Yuborilsin
                                </label>
                                <input type="radio" name="active__answer" id="save_answer">
                                <label for="save_answer">
                                    <i class="fa fa-save"></i>
                                    Saqlab qo'yilsin
                                </label>
                            </li>
                        </ul>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">ortga</button>
                        <button type="button" class="btn btn-primary">Javob Yuborish</button>
                    </div>
                </div>
            </div>
        </div>
    {% endfor %}

{% endblock modal %}
{% block scripts %}
    <script>
        function myFunction() {
            var optionValue = document.getElementById("country").value;
            console.log(optionValue)

            $.ajax({
                url: '',
                datatype: 'json',
                data: {'optionValue': optionValue},
                type: 'GET',
                success: function(data) {
                    const appealList = document.getElementById("appealsList")
                    appealList.innerHTML = "";
                    (data.appeals).forEach(appeal => {
                        const appealHTMLElement = `
                        <tr>
                            <th>${ appeal.id }</th>
                            <td data-toggle="modal" data-target="#scrollmodal${ appeal.pk }" style="word-break: break-all;">${ appeal.applicant_name }</td>
                            <td>${ appeal.appeal_type }</td>
                            <td>${ appeal.applicant_position }</td>
                            {% if appeal.appeal_file %}
                                <td>
                                    <a href="{% url 'download-appealFile' appeal.id %}" style="color: #4272d7">${ appeal.filename }</a>
                                </td>
                            {% else %}
                                <td>-</td>
                            {% endif %}
                        </tr>
                        `
                        appealList.innerHTML += appealHTMLElement;
                    });
                }
            });

        }
        
    </script>
{% endblock scripts %}